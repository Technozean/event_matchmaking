{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Edit {{ event.title }} - Event Matchmaking Platform{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Edit Event</h1>
        <h2 class="text-xl text-gray-600 mt-2">{{ event.title }}</h2>
        <p class="mt-2 text-lg text-gray-600">Update your event details and settings.</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Form -->
        <div class="lg:col-span-2">
            <div class="card">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Event Details</h2>
                <form method="post">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <div class="mt-8 flex space-x-4">
                        <button type="submit" class="btn btn-primary">
                            Update Event
                        </button>
                        <a href="{% url 'event_detail' event.id %}" class="btn btn-secondary">
                            Cancel
                        </a>
                        {% if event.status == 'draft' %}
                        <button type="submit" name="publish" value="true" class="btn bg-green-600 text-white hover:bg-green-700">
                            Save & Publish
                        </button>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>

        <!-- Sidebar with Info -->
        <div class="lg:col-span-1">
            <div class="card">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Event Status</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Current Status</span>
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                            {% if event.status == 'published' %}bg-green-100 text-green-800
                            {% elif event.status == 'draft' %}bg-yellow-100 text-yellow-800
                            {% elif event.status == 'completed' %}bg-blue-100 text-blue-800
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ event.get_status_display }}
                        </span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Participants</span>
                        <span class="font-semibold text-gray-900">{{ event.participant_count }}</span>
                    </div>
                    
                    {% if event.waitlist_count > 0 %}
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Waitlisted</span>
                        <span class="font-semibold text-yellow-600">{{ event.waitlist_count }}</span>
                    </div>
                    {% endif %}
                    
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Created</span>
                        <span class="text-sm text-gray-900">{{ event.created_at|date:"M j, Y" }}</span>
                    </div>
                </div>
            </div>

            {% if event.status == 'published' %}
            <div class="card mt-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">⚠️ Publishing Notice</h3>
                <div class="space-y-3 text-sm text-gray-600">
                    <p>This event is currently <strong>published</strong> and accepting registrations.</p>
                    <p>Changes you make will be visible immediately to participants.</p>
                    <p>Be careful when modifying:</p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>Event date and time</li>
                        <li>Location details</li>
                        <li>Registration deadline</li>
                        <li>Maximum participants</li>
                    </ul>
                </div>
            </div>
            {% endif %}

            <div class="card mt-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                <div class="space-y-3">
                    <a href="{% url 'manage_questions' event.id %}" class="w-full btn btn-secondary text-center">
                        Manage Questions
                    </a>
                    {% if event.enable_qa %}
                    <a href="{% url 'event_qa' event.id %}" class="w-full btn btn-secondary text-center">
                        View Q&A Board
                    </a>
                    {% endif %}
                    {% if event.status == 'published' %}
                    <a href="{% url 'event_registration' event.id %}" class="w-full btn btn-secondary text-center">
                        View Registration Page
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
